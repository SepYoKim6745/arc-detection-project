# 논리적 근거 정리
이 문서는 실시간 아크 감지 시스템의 주요 설계 결정과 관련된 논리적 근거를 정리한 문서입니다.

---

## 1. 파생 피처 생성 함수 (`add_features`)
### 목적
- 단순한 전압/전류 데이터로는 아크 이상을 감지하기 어려움.
- 시간적 패턴과 물리적 특성을 반영하기 위해 파생 피처를 생성.

### 생성된 피처
1. **전압 및 전류의 평균값 (`voltage`, `current`)**:
   - 데이터의 중심값을 나타내며, 이상 감지의 기본적인 기준.
2. **전압 및 전류의 변화량 (`voltage_diff`, `current_diff`)**:
   - 최근 두 샘플 간의 변화량을 계산하여 급격한 변화(아크 발생 가능성)를 감지.
3. **전압 및 전류의 이동 평균 (`voltage_ma`, `current_ma`)**:
   - 최근 5개의 샘플에 대한 이동 평균을 계산하여 노이즈를 줄이고 데이터의 안정적인 추세를 반영.
4. **전력 (`power`)**:
   - 전압과 전류의 곱으로 계산되며, 아크 발생 시 전력의 급격한 변화가 나타날 수 있음.
5. **전력 변화량 (`power_diff`)**:
   - 전력의 변화량을 계산하여 아크 발생 시 나타나는 전력의 급격한 변화를 감지.

### 논리적 근거
- **물리적 특성 반영**: 아크 발생 시 전압과 전류의 급격한 변화가 나타나며, 이는 전력 변화량으로도 나타날 수 있음.
- **모델 성능 향상**: 단순한 원시 데이터보다 파생 피처를 추가하면 모델이 더 많은 정보를 학습할 수 있어 성능이 향상됨.

---

## 2. 이상 감지 후처리 함수 (`postprocess_anomalies_realtime`)
### 목적
- 센서 노이즈나 일시적인 데이터 이상으로 인해 단일 이상 신호가 발생할 수 있음.
- 연속된 이상 신호를 확인하여 신뢰도를 높임.

### 동작
- 최근 `min_consecutive`개의 이상 신호를 확인하여, 모두 이상(1)으로 판정되면 실제 이상으로 간주.
- 연속된 이상 신호가 `min_consecutive` 미만이면 노이즈로 간주하고 무시.

### 논리적 근거
- **노이즈 제거**: 센서 데이터는 노이즈가 포함될 가능성이 높으므로, 단일 이상 신호를 신뢰하지 않고 연속된 신호를 확인.
- **아크의 지속성 반영**: 아크는 일반적으로 짧은 시간 동안 지속적으로 발생하므로, 연속된 이상 신호를 확인하는 것이 물리적 특성과 일치.

---

## 3. 8개로 묶어서 처리한 이유
### 이유
1. **샘플링 주파수와 시간 간격**:
   - 샘플링 주기가 약 860Hz임.
   - 8개의 샘플은 약 9.3ms(8 ÷ 860Hz) 동안의 데이터를 의미.
   - 이는 아크 발생 시 나타나는 급격한 변화를 감지하기에 충분한 시간 간격.

2. **아크의 물리적 특성**:
   - 아크는 일반적으로 짧은 시간(수 ms~수십 ms) 동안 발생하며, 이 시간 동안 전압/전류의 급격한 변화가 나타남.
   - 8개의 샘플은 이러한 짧은 시간 동안의 변화를 포착하기에 적합한 크기.

3. **모델 입력 크기**:
   - Random Forest 모델은 고정된 크기의 입력 데이터를 요구하며, 8개의 샘플로 생성된 파생 피처는 모델 학습 및 추론에 적합한 크기.

4. **실험적 검증**:
   - 8개의 샘플을 기준으로 설정한 것은 실험적으로 노이즈와 실제 이상 신호를 구분하는 데 효과적임이 확인됨.

---

## 4. 이동 평균을 5로 설정한 이유
### 이유
1. **노이즈 제거**:
   - 이동 평균은 최근 샘플의 평균값을 계산하여 노이즈를 줄이고 데이터의 안정적인 추세를 반영.
   - 윈도우 크기를 5로 설정하면 약 5.8ms 동안의 데이터를 기반으로 평활화.

2. **짧은 시간 내의 변화 감지**:
   - 이동 평균의 윈도우 크기를 너무 작게 설정하면 노이즈에 민감해지고, 너무 크게 설정하면 아크의 급격한 변화를 놓칠 수 있음.
   - 5개의 샘플은 이러한 짧은 시간 동안의 변화를 포착하면서도 노이즈를 효과적으로 제거할 수 있는 적절한 크기.

3. **실험적 검증**:
   - 이동 평균의 윈도우 크기를 3, 5, 10 등으로 실험한 결과, 5로 설정했을 때 노이즈 제거와 이상 감지 성능 간의 균형이 가장 적절했음.

---

## 5. 변화량을 최근 두 샘플로 계산한 이유
### 이유
1. **즉각적인 변화 감지**:
   - 변화량은 최근 두 샘플 간의 차이를 계산하여 데이터의 급격한 변화를 즉각적으로 감지.
   - 이는 아크 발생 시 나타나는 급격한 전압/전류 변화를 포착하기에 적합.

2. **단순성과 효율성**:
   - 최근 두 샘플만 비교하면 계산이 간단하고, 실시간 시스템에서 처리 속도를 높일 수 있음.

3. **실험적 검증**:
   - 실험적으로 최근 두 샘플 간의 차이를 사용하는 것이 아크 발생 시의 급격한 변화를 감지하는 데 충분했음.


## 6. 데이터 버퍼 최소 크기(15개)
### 이유
1. CNN 입력 시퀀스 생성 요구사항
- CNN 입력 시퀀스를 생성하기 위해 `seq_len=8`과 슬라이딩 윈도우 구조를 사용.
- 슬라이딩 윈도우는 `seq_len + 7`개의 데이터를 필요로 하며, 이는 최소 15개의 데이터가 있어야 함.

2. 모델 입력 크기
- CNN 모델은 (1, 8, 8) 형태의 입력을 요구하며, 이를 충족하기 위해 8개의 시퀀스와 추가 데이터가 필요.

3. 실시간 데이터 처리
- 실시간 데이터 수집 환경에서 최소 15개의 데이터를 확보한 후 추론을 시작하도록 설계.

---

## 참고
- 샘플링 주기: 약 860Hz
- 이동 평균 윈도우 크기: 5
- 연속 이상 신호 기준: 8개